<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DEEP WORK ZAKARIA</title>

<style>
body{
 margin:0;font-family:Arial,Helvetica,sans-serif;
 background:#0f172a;color:#fff;
 display:flex;justify-content:center;align-items:center;
 min-height:100vh;
}
.app{
 background:#020617;width:100%;max-width:460px;
 border-radius:20px;padding:20px;
 box-shadow:0 20px 50px rgba(0,0,0,.7)
}
h1{text-align:center;color:#38bdf8;margin-bottom:10px}
.timer{font-size:52px;text-align:center;font-weight:bold;display:flex;justify-content:center;align-items:center;gap:8px}
.info{text-align:center;color:#38bdf8;font-size:13px;margin-bottom:8px}
.phase{background:#111827;border-radius:14px;padding:12px;margin-bottom:10px}
input,select,button{
 width:100%;padding:8px;border-radius:8px;border:none;margin-top:6px;font-weight:bold
}
button{background:#22c55e;color:#020617}
button.locked{background:#4b5563;color:#9ca3af}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.card{background:#1e293b;border-radius:12px;padding:10px;text-align:center}
.badge{background:#fbbf24;color:#020617;padding:6px;border-radius:8px;margin-top:5px}
.desc-box{margin-top:6px;padding:10px;border-radius:10px;text-align:center;font-size:13px}
.desc-demarrage{background:#0ea5e9}
.desc-focus{background:#22c55e}
.desc-memoire{background:#8b5cf6}
.desc-pause{background:#6b7280}
.desc-controle{background:#f97316}
#history div{font-size:13px;text-align:left}
</style>
</head>

<body>
<div class="app">

<h1>ğŸ§  DEEP WORK ZAKARIA</h1>

<div class="timer">
 <span id="timerEmoji">â³</span>
 <span id="timerTime">--:--</span>
</div>
<div class="info" id="status">â³ Attente</div>

<div class="phase">
 <h3>â° Heure de dÃ©but</h3>
 <input type="time" id="startTime">

 <h3>ğŸ“š MatiÃ¨re</h3>
 <select id="subject">
  <option value="">Choisir</option>
  <option>PC</option><option>HG</option><option>ANGLAIS</option>
  <option>FRANÃ‡AIS</option><option>MATHS</option><option>SVT</option>
  <option>MUSIQUE</option><option>ESPAGNOL</option><option>EDHC</option>
 </select>

 <div id="totalDuration" class="desc-box desc-demarrage">DurÃ©e totale : -- min</div>
 <div id="currentPhase" class="desc-box desc-demarrage">Phase actuelle : --</div>
 <div id="descBox" class="desc-box desc-demarrage">La description de la session apparaÃ®tra ici.</div>
</div>

<div class="grid">
 <div class="card">â± Heures totales<br><b id="totalHours">0 h</b></div>
 <div class="card">ğŸ”¥ Streak actuel<br><b id="streak">0</b></div>
</div>

<div class="phase"><h3>ğŸ† Badges</h3><div id="badges"></div></div>
<div class="phase"><h3>ğŸ“Š Historique</h3><div id="history"></div></div>

<button id="saveBtn">ğŸ”’ ENREGISTRER</button>

</div>

<script>
const phaseModels=[
 {n:"DÃ©marrage",d:5,desc:"PrÃ©pare ton esprit.",class:"desc-demarrage",emoji:"ğŸš€"},
 {n:"Focus total",d:30,desc:"Concentration absolue.",class:"desc-focus",emoji:"ğŸ”¥"},
 {n:"MÃ©moire active",d:20,desc:"Ancre le savoir.",class:"desc-memoire",emoji:"ğŸ§ "},
 {n:"Pause",d:5,desc:"Recharge ton Ã©nergie.",class:"desc-pause",emoji:"â˜•"},
 {n:"ContrÃ´le",d:10,desc:"Teste-toi.",class:"desc-controle",emoji:"âœ…"}
];

let phases=[],i=0,time=0,run=false,locked=false;
let sessionMinutes=0,sessionClosed=false;

let stats=JSON.parse(localStorage.getItem("dwStats"))||{
 totalMinutes:0,streak:0,lastSuccess:null,history:[]
};

function todayStr(){return new Date().toLocaleDateString("fr-FR");}

subject.onchange=()=>{
 phases=phaseModels;
 sessionMinutes=phases.reduce((a,b)=>a+b.d,0);
 totalDuration.innerText=`DurÃ©e totale : ${sessionMinutes} min`;
};

saveBtn.onclick=()=>{
 if(!startTime.value||!subject.value){alert("â›” Remplis tout");return;}
 document.querySelectorAll("input,select").forEach(e=>e.disabled=true);
 saveBtn.classList.add("locked");
 locked=true;
};

function startPhase(){
 sessionClosed=false;
 const p=phases[i];
 time=p.d*60;
 descBox.className="desc-box "+p.class;
 descBox.innerText=p.desc;
 timerEmoji.innerText=p.emoji;
 status.innerText="â–¶ï¸ En cours";
 run=true;
}

function finishSession(success){
 if(sessionClosed)return;
 sessionClosed=true;
 run=false;
 status.innerText=success?"âœ… TerminÃ©":"âŒ Session annulÃ©e";

 stats.history.unshift({date:todayStr(),subject:subject.value,ok:success});
 if(success){
  stats.totalMinutes+=sessionMinutes;
  if(stats.lastSuccess!==todayStr()){stats.streak++;stats.lastSuccess=todayStr();}
 }
 localStorage.setItem("dwStats",JSON.stringify(stats));
 updateUI();
}

function updateTimer(){
 const m=Math.floor(time/60),s=time%60;
 timerTime.innerText=`${m}:${s.toString().padStart(2,"0")}`;
 if(phases[i])currentPhase.innerText=`${phases[i].n} â± ${m}:${s.toString().padStart(2,"0")}`;
}

setInterval(()=>{
 if(run){
  if(time>0){time--;updateTimer();}
  else{i++;i<phases.length?startPhase():finishSession(true);}
 }
},1000);

setInterval(()=>{
 if(!locked||run)return;
 const [h,m]=startTime.value.split(":").map(Number);
 const n=new Date();
 if(n.getHours()===h&&n.getMinutes()===m&&n.getSeconds()===0){
  i=0;startPhase();
 }
},1000);

document.addEventListener("visibilitychange",()=>{
 if(run&&document.hidden)finishSession(false);
});
window.addEventListener("pagehide",()=>{
 if(run)finishSession(false);
});

function updateUI(){
 totalHours.innerText=(stats.totalMinutes/60).toFixed(1)+" h";
 streak.innerText=stats.streak;
 history.innerHTML="";
 stats.history.forEach(h=>{
  history.innerHTML+=`<div>${h.date}. ${h.subject} ${h.ok?"âœ…":"ğŸŸ¥"}</div>`;
 });
 badges.innerHTML="";
 if(stats.streak>=7)badges.innerHTML+="<div class='badge'>ğŸ¥‰ Alpha</div>";
 if(stats.streak>=30)badges.innerHTML+="<div class='badge'>ğŸ¥ˆ Monk</div>";
 if(stats.streak>=90)badges.innerHTML+="<div class='badge'>ğŸ¥‡ LÃ©gende</div>";
}
updateUI();
</script>
</body>
</html>
