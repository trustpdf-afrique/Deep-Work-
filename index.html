<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DEEP WORK ZAKARIA</title>
<style>
body{
 margin:0;font-family:Arial,Helvetica,sans-serif;
 background:#0f172a;color:#fff;
 display:flex;justify-content:center;align-items:center;
 min-height:100vh;
}
.app{
 background:#020617;width:100%;max-width:460px;
 border-radius:20px;padding:20px;
 box-shadow:0 20px 50px rgba(0,0,0,.7);
}
h1{text-align:center;color:#38bdf8;margin-bottom:4px;}
#motivation{
 text-align:center;font-size:14px;font-weight:bold;margin-bottom:12px;
 background:linear-gradient(90deg,#fbbf24,#38bdf8,#f43f5e);
 -webkit-background-clip:text;-webkit-text-fill-color:transparent;
 animation: glow 2s infinite alternate;
}
@keyframes glow{
 0%{text-shadow:0 0 5px #fbbf24,0 0 10px #38bdf8;}
 50%{text-shadow:0 0 15px #f43f5e,0 0 25px #38bdf8;}
 100%{text-shadow:0 0 20px #fbbf24,0 0 30px #38bdf8;}
}
.timer{
 font-size:60px;font-weight:bold;display:flex;justify-content:center;align-items:center;gap:15px;margin-bottom:10px;
 padding:12px 20px;border:3px solid #38bdf8;border-radius:20px;
 box-shadow:0 0 20px rgba(56,189,248,0.7),0 0 40px rgba(56,189,248,0.5);
 background:linear-gradient(135deg,#0f172a,#1e293b);
 transition:all 0.5s ease;text-shadow:0 0 10px rgba(255,255,255,0.5);
}
.timer.attente{border-color:#94a3b8;box-shadow:0 0 15px rgba(148,163,184,0.5);color:#94a3b8;}
.timer.cours{border-color:#22c55e;box-shadow:0 0 20px rgba(34,197,94,0.7);color:#22c55e;}
.timer.termine{border-color:#fbbf24;box-shadow:0 0 25px rgba(251,191,36,0.8);color:#fbbf24;}
.info{text-align:center;color:#38bdf8;font-size:13px;margin-bottom:10px;}
.phase{background:#111827;border-radius:14px;padding:12px;margin-bottom:10px;}
input,select,button{
 width:100%;padding:8px;border-radius:8px;border:none;margin-top:6px;font-weight:bold;
}
button{background:#22c55e;color:#020617;cursor:pointer;}
button.locked{background:#4b5563;color:#9ca3af;}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.card{background:#1e293b;border-radius:12px;padding:10px;text-align:center;}
.badge{background:#fbbf24;color:#020617;padding:6px;border-radius:8px;margin-top:5px;}
.desc-box{margin-top:6px;padding:10px;border-radius:10px;text-align:center;font-size:13px;}
.desc-demarrage{background:#0ea5e9}
.desc-focus{background:#22c55e}
.desc-memoire{background:#8b5cf6}
.desc-pause{background:#6b7280}
.desc-controle{background:#f97316}
#timerText{
 font-weight:bold;text-align:center;font-size:16px;margin-top:8px;
 background:linear-gradient(90deg,#fbbf24,#38bdf8,#f43f5e);
 -webkit-background-clip:text;-webkit-text-fill-color:transparent;
 animation:shine 2s infinite alternate;
}
@keyframes shine{
 0%{text-shadow:0 0 5px #fbbf24,0 0 10px #38bdf8;}
 50%{text-shadow:0 0 15px #f43f5e,0 0 25px #38bdf8;}
 100%{text-shadow:0 0 20px #fbbf24,0 0 30px #38bdf8;}
}
#progressContainer{
 width:100%;background:#1e293b;height:20px;border-radius:10px;margin:10px 0;overflow:hidden;
}
#progressBar{
 height:100%;
 width:0%;
 background:#22c55e; 
 transition: width 0.5s, background 0.5s;
 border-radius:10px;
}
</style>
</head>

<body>
<div class="app">
<h1>üß† DEEP WORK ZAKARIA</h1>
<div id="motivation">Discipline aujourd‚Äôhui, victoire demain.</div>

<div class="timer" id="timer">
 <span id="timerEmoji">‚è≥</span>
 <span id="timerTime">--:--</span>
</div>

<div id="progressContainer">
 <div id="progressBar"></div>
</div>

<div id="timerText" class="desc-box desc-focus">üöÄ D√©marrage imminent‚Ä¶ Reste concentr√© !</div>

<div class="info" id="status">‚è≥ Attente</div>

<div class="phase">
 <h3>‚è∞ Heure de d√©but</h3>
 <input type="time" id="startTime">

 <h3>üìö Mati√®re</h3>
 <select id="subject">
  <option value="">Choisir</option>
  <option>PC</option><option>HG</option><option>ANGLAIS</option>
  <option>FRAN√áAIS</option><option>MATHS</option><option>SVT</option>
  <option>MUSIQUE</option><option>ESPAGNOL</option><option>EDHC</option>
 </select>

 <label>
   <input type="checkbox" id="tiredCheck"> Je suis fatigu√© aujourd'hui (session courte)
 </label>

 <div id="currentPhase" class="desc-box desc-demarrage">
  Phase actuelle : --
 </div>

 <div id="descBox" class="desc-box desc-demarrage">
  La description de la session appara√Ætra ici.
 </div>
</div>

<div class="grid">
 <div class="card">
  ‚è± Heures totales<br>
  <b id="totalHours">0 h</b>
 </div>
 <div class="card">
  üî• Streak actuel<br>
  <b id="streak">0</b>
 </div>
</div>

<div class="phase">
 <h3>üèÜ Badges</h3>
 <div id="badges"></div>
</div>

<button id="saveBtn">üîí ENREGISTRER</button>

</div>

<script>
// ---------------- CONFIG ----------------
const phaseModels=[
 {n:"D√©marrage",desc:"Lib√®re ton esprit et mets-toi en mode concentration maximale.",class:"desc-demarrage",emoji:"üöÄ"},
 {n:"Focus total",desc:"Rien ne peut te d√©tourner. Chaque seconde compte.",class:"desc-focus",emoji:"üî•"},
 {n:"M√©moire active",desc:"Exprime ce que tu as appris avec tes propres mots.",class:"desc-memoire",emoji:"üß†"},
 {n:"Pause",desc:"Respire et recharge ton √©nergie.",class:"desc-pause",emoji:"‚òï"},
 {n:"Contr√¥le",desc:"Teste-toi et progresse.",class:"desc-controle",emoji:"‚úÖ"}
];
const durations={
 PC:[5,30,20,5,10],
 HG:[5,25,20,5,10],
 ANGLAIS:[5,20,20,5,10],
 FRAN√áAIS:[5,40,20,10,15],
 MATHS:[5,30,25,5,10],
 SVT:[5,25,20,5,10],
 MUSIQUE:[5,20,15,5,10],
 ESPAGNOL:[5,20,20,5,10],
 EDHC:[1,1,1,1,1]
};

let phases=[],i=0,time=0,run=false,locked=false;
let sessionTotalTime=0,hardcoreTimeout;

let stats=JSON.parse(localStorage.getItem("dwStats"))||{
 totalMinutes:0,
 streak:0,
 lastDay:null
};

// ---------------- ELEMENTS ----------------
const timer=document.getElementById("timer");
const status=document.getElementById("status");
const startTime=document.getElementById("startTime");
const subject=document.getElementById("subject");
const saveBtn=document.getElementById("saveBtn");
const timerTime=document.getElementById("timerTime");
const timerEmoji=document.getElementById("timerEmoji");
const descBox=document.getElementById("descBox");
const currentPhase=document.getElementById("currentPhase");
const badges=document.getElementById("badges");
const totalHours=document.getElementById("totalHours");
const streak=document.getElementById("streak");
const timerText=document.getElementById("timerText");
const tiredCheck=document.getElementById("tiredCheck");
const progressBar=document.getElementById("progressBar");

// ---------------- NOTIFICATION ----------------
if("Notification" in window && Notification.permission==="default"){
 Notification.requestPermission();
}
function showDeepWorkNotification(subj,time){
 if(Notification.permission!=="granted") return;
 const n=new Notification("üß† Deep Work ‚Äì Zakaria",{
  body:`Zakaria, l‚Äôheure que vous avez promis √† votre Deep Work est arriv√©e.\nMati√®re : ${subj} ‚Äì ${time}`,
  silent:true
 });
 setTimeout(()=>n.close(),600000);
}
let notifSent=false;
setInterval(()=>{
 if(!locked) return;
 const timeInput=startTime.value;
 const subj=subject.value;
 if(!timeInput||!subj||notifSent) return;

 const [h,m]=timeInput.split(":").map(Number);
 const now=new Date();
 const target=new Date();
 target.setHours(h,m,0,0);

 const diff=(target-now)/60000;
 if(diff<=5 && diff>0 && !notifSent){
  showDeepWorkNotification(subj,timeInput);
  notifSent=true;
 }
 if(diff<-10) notifSent=false;
},1000);

// ---------------- CHOIX MATI√àRE ----------------
subject.onchange=()=>{
 const d=durations[subject.value];
 if(!d) return;
 phases=phaseModels.map((p,idx)=>({...p,d:d[idx]}));
};

// ---------------- ENREGISTRER ----------------
saveBtn.onclick=()=>{
 if(!startTime.value || !subject.value){
  alert("‚õî Choisis l‚Äôheure et la mati√®re");
  return;
 }
 document.querySelectorAll("input,select").forEach(e=>e.disabled=true);
 saveBtn.disabled=true; saveBtn.classList.add("locked");
 locked=true;
 setStatus("‚è≥ Attente");
};

// ---------------- GESTION STATUS ----------------
function setStatus(state){
 status.innerText=state;
 timer.classList.remove("attente","cours","termine");
 if(state.includes("Attente")) timer.classList.add("attente");
 else if(state.includes("En cours")) timer.classList.add("cours");
 else if(state.includes("Termin√©")) timer.classList.add("termine");
}

// ---------------- UI badges, total, streak ----------------
function updateUI(){
 const hours = Math.floor(stats.totalMinutes / 60);
 const minutes = stats.totalMinutes % 60;
 totalHours.innerText = hours>0 ? `${hours} h ${minutes} min` : `${minutes} min`;
 streak.innerText=stats.streak;
 badges.innerHTML="";
 if(stats.streak>=7) badges.innerHTML+="<div class='badge'>ü•â Alpha</div>";
 if(stats.streak>=30) badges.innerHTML+="<div class='badge'>ü•à Monk</div>";
 if(stats.streak>=90) badges.innerHTML+="<div class='badge'>ü•á L√©gende</div>";
}
updateUI();
</script>
</body>
</html>
