<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>DEEP WORK ZAKARIA</title>
<style>
body{
 margin:0;font-family:Arial,Helvetica,sans-serif;
 background:#0f172a;color:#fff;
 display:flex;justify-content:center;align-items:center;
 min-height:100vh;
}
.app{
 background:#020617;width:100%;max-width:460px;
 border-radius:20px;padding:20px;
 box-shadow:0 20px 50px rgba(0,0,0,.7)
}
h1{text-align:center;color:#38bdf8;margin-bottom:10px}
.timer{font-size:52px;text-align:center;color:#22c55e;font-weight:bold}
.info{text-align:center;color:#38bdf8;font-size:13px;margin-bottom:8px}
.phase{background:#111827;border-radius:14px;padding:12px;margin-bottom:10px}
input,select,button{
 width:100%;padding:8px;border-radius:8px;border:none;margin-top:6px;
 font-weight:bold;
}
button{background:#22c55e;color:#020617}
button.locked{background:#4b5563;color:#9ca3af}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.card{background:#1e293b;border-radius:12px;padding:10px;text-align:center}
.badge{background:#fbbf24;color:#020617;padding:6px;border-radius:8px;margin-top:5px}
.desc-box{
 margin-top:6px;padding:10px;border-radius:10px;
 text-align:center;font-size:13px
}
.desc-demarrage{background:#0ea5e9}
.desc-focus{background:#22c55e}
.desc-memoire{background:#8b5cf6}
.desc-pause{background:#6b7280}
.desc-controle{background:#f97316}
#history div{font-size:13px;text-align:left}
</style>
</head>
<body>
<div class="app">

<h1>ğŸ§  DEEP WORK ZAKARIA</h1>

<div class="timer" id="timer">--:--</div>
<div class="info" id="status">â³ Attente</div>

<div class="phase">
 <h3>â° Heure</h3>
 <input type="time" id="startTime">

 <h3>ğŸ“š MatiÃ¨re</h3>
 <select id="subject">
  <option value="">Choisir</option>
  <option>PC</option><option>HG</option><option>ANGLAIS</option>
  <option>FRANÃ‡AIS</option><option>MATHS</option><option>SVT</option>
  <option>MUSIQUE</option><option>ESPAGNOL</option><option>EDHC</option>
 </select>

 <!-- Phase actuelle avec timer -->
 <div id="currentPhase" class="desc-box desc-demarrage">
  Phase actuelle : --:--
 </div>

 <!-- DESCRIPTION AUTOMATIQUE -->
 <div id="descBox" class="desc-box desc-demarrage">
  La description de la session apparaÃ®tra ici.
 </div>
</div>

<div class="grid">
 <div class="card">â± Heures totales<br><b id="totalHours">0 h</b></div>
 <div class="card">ğŸ”¥ Streak actuel<br><b id="streak">0</b></div>
</div>

<div class="phase"><h3>ğŸ† Badges</h3><div id="badges"></div></div>
<div class="phase"><h3>ğŸ“Š Historique</h3><div id="history"></div></div>

<button id="saveBtn">ğŸ”’ ENREGISTRER</button>

</div>

<script>
const phaseModels=[
 {n:"DÃ©marrage",desc:"LibÃ¨re ton esprit et mets-toi en mode concentration maximale. PrÃ©pare-toi Ã  apprendre et Ã  devenir exceptionnel.",class:"desc-demarrage"},
 {n:"Focus total",desc:"Rien ne peut te dÃ©tourner. Sois pleinement immergÃ© dans ta tÃ¢che. Chaque seconde compte.",class:"desc-focus"},
 {n:"MÃ©moire active",desc:"Exprime ce que tu as appris avec tes propres mots. Retient vraiment la connaissance et transforme-la en pouvoir.",class:"desc-memoire"},
 {n:"Pause",desc:"DÃ©tends-toi un peu, respire et reprends des forces pour mieux continuer.",class:"desc-pause"},
 {n:"ContrÃ´le",desc:"Teste-toi, corrige tes erreurs et progresse. Renforce ta comprÃ©hension pour devenir plus fort Ã  chaque Ã©tape.",class:"desc-controle"}
];

const durationsBySubject = {
 "PC":[5,30,20,5,10],
 "HG":[5,25,20,5,10],
 "ANGLAIS":[5,20,20,5,10],
 "FRANÃ‡AIS":[5,40,20,10,15],
 "MATHS":[5,30,25,5,10],
 "SVT":[5,25,20,5,10],
 "MUSIQUE":[5,20,15,5,10],
 "ESPAGNOL":[5,20,20,5,10],
 "EDHC":[5,20,15,5,10]
};

let phases=[],i=0,time=0,run=false,locked=false;
let sessionMinutes=0,resetTimeout=null;

let stats=JSON.parse(localStorage.getItem("dwStats"))||{
 totalMinutes:0,streak:0,lastSuccess:null,history:[]
};

function todayStr(){ return new Date().toLocaleDateString("fr-FR"); }

function lockAll(){
 document.querySelectorAll("input,select").forEach(e=>e.disabled=true);
 saveBtn.disabled=true; saveBtn.classList.add("locked");
 locked=true;
}

// Remplissage automatique des minutes selon matiÃ¨re
subject.addEventListener("change", ()=>{
 const val = subject.value;
 if(durationsBySubject[val]){
   phases = phaseModels.map((p,idx)=>({...p,d:durationsBySubject[val][idx]}));
   sessionMinutes = durationsBySubject[val].reduce((a,b)=>a+b,0);
 }
});

saveBtn.onclick=()=>{
 if(!startTime.value||!subject.value){alert("â›” Remplis tout"); return;}
 lockAll();
 status.innerText="â³ Attente";
};

function startPhase(){
 const p=phases[i];
 time=p.d*60;
 status.innerText="â–¶ï¸ En cours";
 descBox.className="desc-box "+p.class;
 descBox.innerText=p.desc;
 run=true;
}

function finishSession(success){
 run=false;
 status.innerText="âœ… TerminÃ©";

 stats.history.unshift({date:todayStr(),subject:subject.value,ok:success});
 if(success){
  stats.totalMinutes+=sessionMinutes;
  if(stats.lastSuccess!==todayStr()){ stats.streak++; stats.lastSuccess=todayStr();}
 }
 localStorage.setItem("dwStats",JSON.stringify(stats));
 updateUI();

 resetTimeout=setTimeout(()=>{ status.innerText="â³ Attente"; currentPhase.innerText="Phase actuelle : --:--"; },120000);
}

function updateTimerDisplay(){
 const min=Math.floor(time/60);
 const sec=time%60;
 timer.innerText=`${min}:${sec.toString().padStart(2,'0')}`;

 if(phases[i]){
   currentPhase.innerText = `Phase actuelle : ${phases[i].n} â± ${min}:${sec.toString().padStart(2,'0')}`;
 }
}

setInterval(()=>{
 if(run){
  if(time>0){ time--; updateTimerDisplay(); }
  else{ i++; if(i<phases.length) startPhase(); else finishSession(true); }
 }
},1000);

setInterval(()=>{
 if(!locked||run) return;
 const now=new Date();
 const [h,m]=startTime.value.split(":").map(Number);
 if(now.getHours()===h && now.getMinutes()===m && now.getSeconds()===0){ i=0; startPhase(); }
},1000);

/* HARDCORE */
document.addEventListener("visibilitychange",()=>{
 if(run && document.hidden){ alert("âŒ Hardcore : session annulÃ©e"); finishSession(false); }
});

function updateUI(){
 totalHours.innerText=(stats.totalMinutes/60).toFixed(1)+" h";
 streak.innerText=stats.streak;

 history.innerHTML="";
 stats.history.slice(0,10).forEach(h=>{ history.innerHTML+=`<div>${h.date}. ${h.subject} ${h.ok?"âœ…":"ğŸŸ¥"}</div>`; });

 badges.innerHTML="";
 if(stats.streak>=7) badges.innerHTML+="<div class='badge'>ğŸ¥‰ Alpha</div>";
 if(stats.streak>=30) badges.innerHTML+="<div class='badge'>ğŸ¥ˆ Monk</div>";
 if(stats.streak>=90) badges.innerHTML+="<div class='badge'>ğŸ¥‡ LÃ©gende</div>";
}
updateUI();
</script>
</body>
</html>
