<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DEEP WORK ZAKARIA</title>

<style>
body{
 margin:0;font-family:Arial,Helvetica,sans-serif;
 background:#0f172a;color:#fff;
 display:flex;justify-content:center;align-items:center;
 min-height:100vh;
}
.app{
 background:#020617;width:100%;max-width:460px;
 border-radius:20px;padding:20px;
 box-shadow:0 20px 50px rgba(0,0,0,.7)
}
h1{text-align:center;color:#38bdf8;margin:0}
.timer{font-size:52px;text-align:center;color:#22c55e;font-weight:bold}
.info{text-align:center;color:#38bdf8;font-size:13px;margin-bottom:6px}
.phase{background:#111827;border-radius:14px;padding:12px;margin-bottom:10px}
input,select,button{
 width:100%;padding:8px;border-radius:8px;border:none;margin-top:6px;
 font-weight:bold;
}
button{background:#22c55e;color:#020617;cursor:pointer}
button.locked{background:#4b5563;color:#9ca3af}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.card{background:#1e293b;border-radius:12px;padding:10px;text-align:center}
.badge{background:#fbbf24;color:#020617;padding:6px;border-radius:8px;margin-top:5px}
#history{display:grid;grid-template-columns:1fr 1fr;gap:6px}
</style>
</head>

<body>
<div class="app">

<h1>ğŸ§  DEEP WORK ZAKARIA</h1>

<div class="timer" id="timer">--:--</div>
<div class="info" id="status">â³ En attente</div>

<!-- CONFIG -->
<div class="phase">
 <h3>â° Heure</h3>
 <input type="time" id="startTime">
 <h3>ğŸ“š MatiÃ¨re</h3>
 <select id="subject">
  <option value="">Choisir</option>
  <option>PC</option><option>HG</option><option>ANGLAIS</option>
  <option>FRANÃ‡AIS</option><option>MATHS</option><option>SVT</option>
  <option>MUSIQUE</option><option>ESPAGNOL</option><option>EDHC</option>
 </select>
 <h3>â± Minutes</h3>
 <input type="number" id="t1" value="5">
 <input type="number" id="t2" value="40">
 <input type="number" id="t3" value="20">
 <input type="number" id="t4" value="10">
 <input type="number" id="t5" value="15">
</div>

<!-- STATS -->
<div class="grid">
 <div class="card">â± Total<br><b id="totalHours">0 h</b></div>
 <div class="card">ğŸ”¥ Streak<br><b id="streak">0</b></div>
</div>

<div class="phase"><h3>ğŸ† Badges</h3><div id="badges"></div></div>
<div class="phase"><h3>ğŸ“Š Historique</h3><div id="history"></div></div>

<!-- BOUTON ENREGISTRER -->
<button id="saveBtn">ğŸ”’ ENREGISTRER</button>

</div>

<script>
let locked=false,run=false,i=0,time=0,phases=[];
let stats=JSON.parse(localStorage.getItem("dwStats"))||{
 total:0,streak:0,last:null,history:[]
};

function lockAll(){
 document.querySelectorAll("input,select").forEach(e=>e.disabled=true);
 saveBtn.classList.add("locked");
 saveBtn.disabled=true;
 locked=true;
}

saveBtn.onclick=()=>{
 if(!startTime.value||!subject.value){alert("â›” Remplis tout");return;}
 phases=[
  {n:"DÃ©marrage",d:+t1.value},
  {n:"Focus",d:+t2.value},
  {n:"MÃ©moire",d:+t3.value},
  {n:"Pause",d:+t4.value},
  {n:"ContrÃ´le",d:+t5.value}
 ];
 lockAll();
 status.innerText="ğŸ”’ Configuration enregistrÃ©e";
};

function startPhase(){
 const p=phases[i];
 time=p.d*60;
 status.innerText="â–¶ï¸ "+p.n+" ("+subject.value+")";
 run=true;
}

setInterval(()=>{
 if(run){
  if(time>0){
   time--;
   timer.innerText=Math.floor(time/60)+":"+String(time%60).padStart(2,"0");
  }else{
   i++;
   if(i<phases.length) startPhase();
   else finish(true);
  }
 }
},1000);

setInterval(()=>{
 if(!locked||run) return;
 const now=new Date();
 const [h,m]=startTime.value.split(":").map(Number);
 if(now.getHours()===h && now.getMinutes()===m && now.getSeconds()===0){
  i=0;startPhase();
 }
},1000);

function finish(success){
 run=false;
 const today=new Date().toLocaleDateString();
 stats.history.push({date:today,ok:success});
 if(success){
  stats.total+=phases.reduce((a,b)=>a+b.d,0);
  if(stats.last!==today) stats.streak++;
  stats.last=today;
 }
 localStorage.setItem("dwStats",JSON.stringify(stats));
 updateUI();
}

document.addEventListener("visibilitychange",()=>{
 if(run && document.hidden){
  alert("âŒ Hardcore : session annulÃ©e");
  finish(false);
 }
});

function updateUI(){
 totalHours.innerText=(stats.total/60).toFixed(1)+" h";
 streak.innerText=stats.streak;
 history.innerHTML="";
 stats.history.slice(-6).forEach(h=>{
  const d=document.createElement("div");
  d.className="card";
  d.innerText=(h.ok?"âœ…":"âŒ")+" "+h.date;
  history.appendChild(d);
 });
 badges.innerHTML="";
 if(stats.streak>=7) badges.innerHTML+="<div class='badge'>ğŸ¥‰ Alpha</div>";
 if(stats.streak>=30) badges.innerHTML+="<div class='badge'>ğŸ¥ˆ Monk</div>";
 if(stats.streak>=90) badges.innerHTML+="<div class='badge'>ğŸ¥‡ LÃ©gende</div>";
}
updateUI();
</script>

</body>
</html>
